<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEB VTEC - Your Premier Online Marketplace</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a73e8;
            --primary-dark: #1557b0;
            --secondary: #0f172a;
            --accent: #f59e0b;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --background: #ffffff;
            --background-light: #f8fafc;
            --background-dark: #1e293b;
            --border: #e2e8f0;
            --border-light: #f1f5f9;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            --gradient-primary: linear-gradient(135deg, #1a73e8 0%, #4285f4 100%);
            --gradient-accent: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--background-light);
        }

        /* Header & Navigation */
        .header {
            background: var(--background);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-sm);
        }

        .header-top {
            background: var(--secondary);
            color: white;
            padding: 8px 0;
            font-size: 14px;
            text-align: center;
        }

        ..header-main {
    padding: 8px 0;
        }

        .header-container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .logo {
            font-size: 32px;
            font-weight: 800;
            color: var(--primary);
            text-decoration: none;
            letter-spacing: -1px;
        }

        .search-container {
            flex: 1;
            max-width: 600px;
            position: relative;
        }

        .search-form {
            display: flex;
            border: 2px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            background: var(--background);
            transition: all 0.2s ease;
        }

        .search-form:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgb(26 115 232 / 0.1);
        }

        .search-input {
            flex: 1;
            padding: 14px 16px;
            border: none;
            font-size: 16px;
            outline: none;
            background: transparent;
        }

        .search-btn {
            padding: 14px 20px;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        .search-btn:hover {
            background: var(--primary-dark);
        }

        .header-actions {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .header-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: var(--text-primary);
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
            position: relative;
        }

        .header-btn:hover {
            background: var(--background-light);
            color: var(--primary);
        }

        .header-btn i {
            font-size: 20px;
        }

        .cart-count {
            position: absolute;
            top: 4px;
            right: 6px;
            background: var(--error);
            color: white;
            border-radius: 10px;
            width: 20px;
            height: 20px;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .nav {
            background: var(--background);
            border-top: 1px solid var(--border);
            padding: 12px 0;
        }

        .nav-container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            gap: 32px;
            overflow-x: auto;
        }

        .nav-item {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            white-space: nowrap;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .nav-item:hover, .nav-item.active {
            background: var(--primary);
            color: white;
        }

        /* Main Layout */
        .main-container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Hero Section */
        .hero {
            background: var(--gradient-primary);
            color: white;
            padding: 80px 0;
            margin: 32px 0;
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(255,255,255,0.1) 100%);
        }

        .hero-content {
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .hero h1 {
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: 800;
            margin-bottom: 24px;
            line-height: 1.1;
        }

        .hero p {
            font-size: 1.25rem;
            margin-bottom: 40px;
            opacity: 0.9;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: white;
            color: var(--primary);
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-secondary:hover {
            background: white;
            color: var(--primary);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--error);
            color: white;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        .btn-lg {
            padding: 18px 36px;
            font-size: 18px;
        }

        /* Categories Grid */
        .categories {
            margin: 60px 0;
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 40px;
            color: var(--text-primary);
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
        }

        .category-card {
            background: var(--background);
            border-radius: 16px;
            padding: 32px 24px;
            text-align: center;
            text-decoration: none;
            color: var(--text-primary);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .category-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary);
        }

        .category-card:hover::before {
            opacity: 0.05;
        }

        .category-card:hover * {
            color: var(--primary);
        }

        .category-icon {
            font-size: 3.5rem;
            margin-bottom: 16px;
            color: var(--primary);
            position: relative;
            z-index: 1;
        }

        .category-name {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .category-count {
            color: var(--text-secondary);
            font-size: 0.9rem;
            position: relative;
            z-index: 1;
        }

        /* Products Section */
        .products {
            margin: 60px 0;
        }

        .products-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .products-filters {
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--background);
            font-size: 14px;
            outline: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgb(26 115 232 / 0.1);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 24px;
        }

        .product-card {
            background: var(--background);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .product-image {
            width: 100%;
            height: 240px;
            background: var(--background-light);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: var(--accent);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .product-info {
            padding: 24px;
        }

        .product-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-seller {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 12px;
        }

        .product-rating {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .stars {
            display: flex;
            gap: 2px;
        }

        .star {
            color: var(--accent);
            font-size: 14px;
        }

        .star.empty {
            color: var(--border);
        }

        .rating-text {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .product-original-price {
            text-decoration: line-through;
            color: var(--text-secondary);
            font-size: 1rem;
            margin-left: 8px;
            font-weight: 400;
        }

        .product-shipping {
            color: var(--success);
            font-size: 0.9rem;
            margin-bottom: 16px;
            font-weight: 500;
        }

        .product-actions {
            display: flex;
            gap: 8px;
        }

        /* Seller Dashboard */
        .dashboard {
            background: var(--background);
            border-radius: 16px;
            padding: 32px;
            margin: 32px 0;
            border: 1px solid var(--border);
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 16px;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--gradient-primary);
            color: white;
            padding: 28px;
            border-radius: 16px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            transform: translate(20px, -20px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        /* Forms */
        .form-container {
            background: var(--background-light);
            padding: 32px;
            border-radius: 16px;
            margin-bottom: 32px;
            display: none;
        }

        .form-container.active {
            display: block;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            transition: all 0.2s ease;
            background: var(--background);
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgb(26 115 232 / 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        .form-actions {
            display: flex;
            gap: 16px;
            justify-content: flex-end;
            margin-top: 24px;
            flex-wrap: wrap;
        }

        /* Subscription Modal */
        .subscription-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .subscription-modal.active {
            display: flex;
        }

        .subscription-content {
            background: var(--background);
            border-radius: 20px;
            padding: 48px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            position: relative;
        }

        .subscription-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .subscription-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .subscription-price {
            font-size: 3rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .subscription-period {
            color: var(--text-secondary);
            margin-bottom: 32px;
            font-size: 1.1rem;
        }

        .subscription-features {
            list-style: none;
            text-align: left;
            margin-bottom: 32px;
        }

        .subscription-features li {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.1rem;
        }

        .subscription-features .check {
            color: var(--success);
            font-weight: 600;
        }

        /* Cart Sidebar */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -100%;
            width: 450px;
            height: 100vh;
            background: var(--background);
            box-shadow: var(--shadow-xl);
            transition: all 0.3s ease;
            z-index: 3000;
            display: flex;
            flex-direction: column;
        }

        .cart-sidebar.active {
            right: 0;
        }

        .cart-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-title {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .cart-close {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .cart-close:hover {
            background: var(--background-light);
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .cart-item {
            display: flex;
            gap: 16px;
            padding: 16px 0;
            border-bottom: 1px solid var(--border-light);
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-image {
            width: 80px;
            height: 80px;
            background: var(--background-light);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .cart-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-title {
            font-weight: 600;
            margin-bottom: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .cart-item-price {
            color: var(--primary);
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .qty-input {
            width: 60px;
            padding: 4px 8px;
            border: 1px solid var(--border);
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }

        .remove-btn {
            background: none;
            border: none;
            color: var(--error);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .remove-btn:hover {
            background: rgba(239, 68, 68, 0.1);
        }

        .cart-footer {
            padding: 24px;
            border-top: 1px solid var(--border);
            background: var(--background-light);
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 24px;
        }

        .cart-subtotal {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .cart-shipping {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--success);
            margin-bottom: 16px;
            font-weight: 500;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--background);
            border-radius: 16px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            font-size: 20px;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--background-light);
        }

        .modal-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 32px;
            text-align: center;
        }

        /* Alert Styles */
        .alert {
            position: fixed;
            top: 80px;
            right: 24px;
            padding: 16px 20px;
            border-radius: 12px;
            font-weight: 500;
            z-index: 4000;
            min-width: 300px;
            transform: translateX(100%);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alert.show {
            transform: translateX(0);
        }

        .alert-success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }

        /* Footer */
        .footer {
            background: var(--secondary);
            color: white;
            padding: 60px 0 24px;
            margin-top: 80px;
        }

        .footer-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 24px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 40px;
        }

        .footer-section h3 {
            margin-bottom: 24px;
            color: var(--accent);
            font-size: 1.25rem;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 12px;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .footer-links a:hover {
            color: white;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 40px;
            margin-top: 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
        }

        /* Loading Spinner */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 16px;
            }

            .search-container {
                order: 3;
                width: 100%;
            }

            .hero {
                padding: 60px 0;
                margin: 16px 0;
            }

            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }

            .products-header {
                flex-direction: column;
                align-items: stretch;
            }

            .cart-sidebar {
                width: 100%;
                right: -100%;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .dashboard-header {
                flex-direction: column;
                align-items: stretch;
            }

            .modal-content, .subscription-content {
                padding: 24px;
            }
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-up {
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>
    
    <header>
    <!-- Header -->
    <div class="header-top">
    <div class="header-container">
        WEB VTEC
    </div>
    </div>
        
        <div class="header-main">
            <div class="header-container">
                <a href="#" class="logo">WEB VTEC</a>
                
                <div class="search-container">
                    <form class="search-form" id="searchForm">
                        <input type="text" class="search-input" id="searchInput" 
                               placeholder="Search for products, brands, categories...">
                        <button type="submit" class="search-btn">
                            <i class="fas fa-search"></i>
                        </button>
                    </form>
                </div>
                
                <div class="header-actions">
                    <a href="#" class="header-btn" id="accountBtn">
                        <i class="fas fa-user"></i>
                        <span id="accountText">Account</span>
                    </a>
                    
                    <a href="#" class="header-btn" id="sellerBtn">
                        <i class="fas fa-store"></i>
                        <span>Sell</span>
                    </a>
                    
                    <a href="#" class="header-btn" id="cartBtn">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Cart</span>
                        <span class="cart-count" id="cartCount">0</span>
                    </a>
                </div>
            </div>
        </div>
        
        <nav class="nav">
            <div class="nav-container">
                <a href="#" class="nav-item active">Home</a>
                <a href="#" class="nav-item" data-category="electronics">Electronics</a>
                <a href="#" class="nav-item" data-category="fashion">Fashion</a>
                <a href="#" class="nav-item" data-category="home">Home & Garden</a>
                <a href="#" class="nav-item" data-category="sports">Sports & Fitness</a>
                <a href="#" class="nav-item" data-category="books">Books & Media</a>
                <a href="#" class="nav-item" data-category="toys">Toys & Games</a>
                <a href="#" class="nav-item" data-category="health">Health & Beauty</a>
                <a href="#" class="nav-item" data-category="automotive">Automotive</a>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Hero Section -->
        <section class="hero fade-in">
            <div class="hero-content">
                <h1>Discover Amazing Products</h1>
                <p>Shop millions of products from trusted sellers worldwide. Find everything you need in one place.</p>
                <div class="hero-buttons">
                    <a href="#products" class="btn btn-primary">
                        <i class="fas fa-shopping-bag"></i>
                        Start Shopping
                    </a>
                    <button class="btn btn-secondary" id="becomeSellerBtn">
                        <i class="fas fa-store"></i>
                        Become a Seller
                    </button>
                </div>
            </div>
        </section>

        <!-- Categories -->
        <section class="categories">
            <h2 class="section-title">Shop by Category</h2>
            <div class="categories-grid" id="categoriesGrid">
                <!-- Categories will be dynamically loaded -->
            </div>
        </section>

        <!-- Products Section -->
        <section class="products" id="products">
            <div class="products-header">
                <h2 class="section-title">Featured Products</h2>
                <div class="products-filters">
                    <select class="filter-select" id="categoryFilter">
                        <option value="">All Categories</option>
                    </select>
                    <select class="filter-select" id="sortFilter">
                        <option value="featured">Sort by: Featured</option>
                        <option value="price-low">Price: Low to High</option>
                        <option value="price-high">Price: High to Low</option>
                        <option value="rating">Customer Rating</option>
                        <option value="newest">Newest First</option>
                    </select>
                    <select class="filter-select" id="priceFilter">
                        <option value="">All Prices</option>
                        <option value="0-25">Under $25</option>
                        <option value="25-50">$25 - $50</option>
                        <option value="50-100">$50 - $100</option>
                        <option value="100-">Over $100</option>
                    </select>
                </div>
            </div>
            
            <div class="products-grid" id="productsGrid">
                <!-- Products will be dynamically loaded -->
            </div>
            
            <div id="loadingProducts" style="text-align: center; padding: 40px; display: none;">
                <div class="loading" style="width: 40px; height: 40px; border-width: 4px;"></div>
                <p style="margin-top: 16px; color: var(--text-secondary);">Loading products...</p>
            </div>
        </section>

        <!-- Seller Dashboard -->
        <section class="dashboard" id="sellerDashboard">
            <div class="dashboard-header">
                <div>
                    <h2 class="section-title">Seller Dashboard</h2>
                    <p style="color: var(--text-secondary);">Manage your products and track your sales</p>
                </div>
                <div style="display: flex; gap: 16px;">
                    <button class="btn btn-primary" id="addProductBtn">
                        <i class="fas fa-plus"></i>
                        Add Product
                    </button>
                    <button class="btn btn-secondary" id="manageSubscriptionBtn">
                        <i class="fas fa-credit-card"></i>
                        Subscription
                    </button>
                </div>
            </div>
            
            <div class="dashboard-stats" id="dashboardStats">
                <!-- Stats will be dynamically loaded -->
            </div>
            
            <!-- Product Form -->
            <div class="form-container" id="productFormContainer">
                <h3 style="margin-bottom: 24px; font-size: 1.5rem;">Add New Product</h3>
                <form id="productForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Product Title *</label>
                            <input type="text" class="form-input" name="title" required 
                                   placeholder="Enter product title">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Price (USD) *</label>
                            <input type="number" class="form-input" name="price" step="0.01" min="0" required
                                   placeholder="0.00">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Category *</label>
                            <select class="form-select" name="category" required>
                                <option value="">Select Category</option>
                                <option value="electronics">Electronics</option>
                                <option value="fashion">Fashion</option>
                                <option value="home">Home & Garden</option>
                                <option value="sports">Sports & Fitness</option>
                                <option value="books">Books & Media</option>
                                <option value="toys">Toys & Games</option>
                                <option value="health">Health & Beauty</option>
                                <option value="automotive">Automotive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Condition *</label>
                            <select class="form-select" name="condition" required>
                                <option value="">Select Condition</option>
                                <option value="new">New</option>
                                <option value="used-like-new">Used - Like New</option>
                                <option value="used-good">Used - Good</option>
                                <option value="used-fair">Used - Fair</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description *</label>
                        <textarea class="form-textarea" name="description" required
                                  placeholder="Describe your product in detail..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Stock Quantity *</label>
                            <input type="number" class="form-input" name="stock" min="1" required
                                   placeholder="Available quantity">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Weight (lbs)</label>
                            <input type="number" class="form-input" name="weight" step="0.1" min="0"
                                   placeholder="Shipping weight">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Shipping Time (days)</label>
                            <select class="form-select" name="shippingTime">
                                <option value="1-2">1-2 days</option>
                                <option value="3-5">3-5 days</option>
                                <option value="5-7">5-7 days</option>
                                <option value="7-14">1-2 weeks</option>
                                <option value="14+">2+ weeks</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Brand</label>
                            <input type="text" class="form-input" name="brand" 
                                   placeholder="Product brand">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Product Images *</label>
                        <input type="file" class="form-input" name="images" multiple accept="image/*" required>
                        <small style="color: var(--text-secondary); margin-top: 4px; display: block;">
                            Upload up to 5 images. First image will be the main product photo.
                        </small>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelProductBtn">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            Save Product
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Seller Products List -->
            <div id="sellerProducts">
                <h3 style="margin-bottom: 24px;">Your Products</h3>
                <div id="sellerProductsList">
                    <!-- Seller products will be loaded here -->
                </div>
            </div>
        </section>
    </main>

    <!-- Cart Sidebar -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h3 class="cart-title">Shopping Cart</h3>
            <button class="cart-close" id="cartCloseBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="cart-items" id="cartItems">
            <div style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">
                <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 16px; opacity: 0.3;"></i>
                <p style="font-size: 1.1rem; margin-bottom: 8px;">Your cart is empty</p>
                <p style="font-size: 0.9rem;">Add some amazing products!</p>
            </div>
        </div>
        
        <div class="cart-footer" id="cartFooter" style="display: none;">
            <div class="cart-subtotal">
                <span>Subtotal:</span>
                <span id="cartSubtotal">$0.00</span>
            </div>
            <div class="cart-shipping">
    <span>Shipping:</span>
    <span>Handled by Sellers</span>
            </div>
            <div class="cart-total">
                <span>Total:</span>
                <span id="cartTotal">$0.00</span>
            </div>
            <button class="btn btn-primary btn-lg" id="checkoutBtn" style="width: 100%;">
                <i class="fas fa-credit-card"></i>
                Proceed to Checkout
            </button>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <button class="modal-close" id="authModalClose">
                <i class="fas fa-times"></i>
            </button>
            
            <h2 class="modal-title" id="authTitle">Welcome Back</h2>
            <p style="text-align: center; color: var(--text-secondary); margin-bottom: 32px;" id="authSubtitle">
                Sign in to your account
            </p>
            
            <form id="authForm">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-input" name="email" required 
                           placeholder="Enter your email">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" name="password" required
                           placeholder="Enter your password">
                </div>
                
                <div class="form-group" id="confirmPasswordGroup" style="display: none;">
                    <label class="form-label">Confirm Password</label>
                    <input type="password" class="form-input" name="confirmPassword"
                           placeholder="Confirm your password">
                </div>
                
                <div class="form-group" id="profileFieldsGroup" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">First Name</label>
                            <input type="text" class="form-input" name="firstName"
                                   placeholder="First name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Last Name</label>
                            <input type="text" class="form-input" name="lastName"
                                   placeholder="Last name">
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;" id="authSubmitBtn">
                    Sign In
                </button>
            </form>
            
            <div style="text-align: center; margin-top: 24px;">
                <p style="color: var(--text-secondary);">
                    <span id="authSwitchText">Don't have an account?</span>
                    <button type="button" style="background: none; border: none; color: var(--primary); cursor: pointer; text-decoration: underline;" id="authSwitchBtn">
                        Sign up
                    </button>
                </p>
            </div>
        </div>
    </div>

    <!-- Seller Subscription Modal -->
    <div class="subscription-modal" id="subscriptionModal">
        <div class="subscription-content">
            <button class="subscription-close" id="subscriptionClose">
                <i class="fas fa-times"></i>
            </button>
            
            <h2 class="subscription-title">WEB VTEC Seller Plan</h2>
            <div class="subscription-price">$25</div>
            <div class="subscription-period">per month</div>
            
            <ul class="subscription-features">
                <li><i class="fas fa-check check"></i> Unlimited product listings</li>
                <li><i class="fas fa-check check"></i> Advanced analytics dashboard</li>
                <li><i class="fas fa-check check"></i> Priority customer support</li>
                <li><i class="fas fa-check check"></i> Promotional tools & badges</li>
                <li><i class="fas fa-check check"></i> Multi-image uploads</li>
                <li><i class="fas fa-check check"></i> Bulk product management</li>
                <li><i class="fas fa-check check"></i> Custom store branding</li>
                <li><i class="fas fa-check check"></i> Automated inventory tracking</li>
            </ul>
            
            <button class="btn btn-primary btn-lg" id="subscribeBtn" style="width: 100%;">
                <i class="fas fa-credit-card"></i>
                Start Selling - $25/month
            </button>
            
            <p style="text-align: center; margin-top: 16px; color: var(--text-secondary); font-size: 0.9rem;">
                Cancel anytime. No setup fees.
            </p>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div class="modal" id="checkoutModal">
        <div class="modal-content" style="max-width: 800px;">
            <button class="modal-close" id="checkoutClose">
                <i class="fas fa-times"></i>
            </button>
            
            <h2 class="modal-title">Secure Checkout</h2>
            
            <div id="checkoutContent">
                <!-- Checkout form will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>About WEB VTEC</h3>
                <p>Your premier online marketplace connecting buyers and sellers worldwide. Discover amazing products, support businesses, and enjoy secure shopping with fast shipping.</p>
                <div style="margin-top: 24px;">
                    <a href="#" style="color: var(--accent); margin-right: 16px; font-size: 1.5rem;">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="#" style="color: var(--accent); margin-right: 16px; font-size: 1.5rem;">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="#" style="color: var(--accent); margin-right: 16px; font-size: 1.5rem;">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="#" style="color: var(--accent); font-size: 1.5rem;">
                        <i class="fab fa-youtube"></i>
                    </a>
                </div>
            </div>
            
            <div class="footer-section">
                <h3>Customer Service</h3>
                <ul class="footer-links">
                    <li><a href="#">Help Center</a></li>
                    <li><a href="#">Returns & Refunds</a></li>
                    <li><a href="#">Shipping Information</a></li>
                    <li><a href="#">Track Your Order</a></li>
                    <li><a href="#">Contact Support</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>For Sellers</h3>
                <ul class="footer-links">
                    <li><a href="#">Start Selling</a></li>
                    <li><a href="#">Seller Dashboard</a></li>
                    <li><a href="#">Seller Fees</a></li>
                    <li><a href="#">Seller Resources</a></li>
                    <li><a href="#">Seller Support</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Company</h3>
                <ul class="footer-links">
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Careers</a></li>
                    <li><a href="#">Press</a></li>
                    <li><a href="#">Investor Relations</a></li>
                    <li><a href="#">Sustainability</a></li>
                </ul>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2024 WEB VTEC. All rights reserved. | <a href="#" style="color: inherit;">Privacy Policy</a> | <a href="#" style="color: inherit;">Terms of Service</a> | <a href="#" style="color: inherit;">Accessibility</a></p>
        </div>
    </footer>

    <!-- Scripts -->
    <!-- Firebase SDK v9 -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>
    
    <!-- Stripe Payment SDK -->
    <script src="https://js.stripe.com/v3/"></script>

    <script>
        // ======================
        // FIREBASE CONFIGURATION
        // ======================
        // TODO: Replace with your Firebase config
        const firebaseConfig = {
            apiKey: "your-api-key-here",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789012",
            appId: "your-app-id-here",
            measurementId: "your-measurement-id"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();
        const functions = firebase.functions();

        // ======================
        // STRIPE CONFIGURATION
        // ======================
        // TODO: Replace with your Stripe publishable key
        const stripe = Stripe('pk_test_your_stripe_publishable_key_here');

        // ======================
        // GLOBAL VARIABLES
        // ======================
        let currentUser = null;
        let userProfile = null;
        let cart = [];
        let products = [];
        let categories = [];
        let isSellerMode = false;
        let sellerSubscription = null;
        let currentAuthMode = 'signin'; // signin or signup

        // ======================
        // SAMPLE DATA STRUCTURE
        // ======================
        const sampleCategories = [
            { id: 'electronics', name: 'Electronics', icon: 'fas fa-laptop', count: 1250 },
            { id: 'fashion', name: 'Fashion', icon: 'fas fa-tshirt', count: 890 },
            { id: 'home', name: 'Home & Garden', icon: 'fas fa-home', count: 654 },
            { id: 'sports', name: 'Sports & Fitness', icon: 'fas fa-dumbbell', count: 432 },
            { id: 'books', name: 'Books & Media', icon: 'fas fa-book', count: 789 },
            { id: 'toys', name: 'Toys & Games', icon: 'fas fa-gamepad', count: 345 },
            { id: 'health', name: 'Health & Beauty', icon: 'fas fa-heart', count: 567 },
            { id: 'automotive', name: 'Automotive', icon: 'fas fa-car', count: 234 }
        ];

        // ======================
        // DOM ELEMENTS
        // ======================
        const elements = {
            // Auth
            authModal: document.getElementById('authModal'),
            authForm: document.getElementById('authForm'),
            authTitle: document.getElementById('authTitle'),
            authSubtitle: document.getElementById('authSubtitle'),
            authSubmitBtn: document.getElementById('authSubmitBtn'),
            authSwitchBtn: document.getElementById('authSwitchBtn'),
            authSwitchText: document.getElementById('authSwitchText'),
            confirmPasswordGroup: document.getElementById('confirmPasswordGroup'),
            profileFieldsGroup: document.getElementById('profileFieldsGroup'),
            
            // Navigation
            accountBtn: document.getElementById('accountBtn'),
            accountText: document.getElementById('accountText'),
            cartBtn: document.getElementById('cartBtn'),
            cartCount: document.getElementById('cartCount'),
            sellerBtn: document.getElementById('sellerBtn'),
            
            // Search
            searchForm: document.getElementById('searchForm'),
            searchInput: document.getElementById('searchInput'),
            
            // Products
            categoriesGrid: document.getElementById('categoriesGrid'),
            productsGrid: document.getElementById('productsGrid'),
            categoryFilter: document.getElementById('categoryFilter'),
            sortFilter: document.getElementById('sortFilter'),
            priceFilter: document.getElementById('priceFilter'),
            loadingProducts: document.getElementById('loadingProducts'),
            
            // Cart
            cartSidebar: document.getElementById('cartSidebar'),
            cartItems: document.getElementById('cartItems'),
            cartFooter: document.getElementById('cartFooter'),
            cartSubtotal: document.getElementById('cartSubtotal'),
            cartTotal: document.getElementById('cartTotal'),
            
            // Seller
            sellerDashboard: document.getElementById('sellerDashboard'),
            addProductBtn: document.getElementById('addProductBtn'),
            productFormContainer: document.getElementById('productFormContainer'),
            productForm: document.getElementById('productForm'),
            dashboardStats: document.getElementById('dashboardStats'),
            sellerProductsList: document.getElementById('sellerProductsList'),
            
            // Subscription
            subscriptionModal: document.getElementById('subscriptionModal'),
            subscribeBtn: document.getElementById('subscribeBtn'),
            
            // Checkout
            checkoutModal: document.getElementById('checkoutModal'),
            checkoutContent: document.getElementById('checkoutContent')
        };

        // ======================
        // INITIALIZATION
        // ======================
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadInitialData();
        });

        function initializeApp() {
            console.log('Initializing WEB VTEC...');
            
            // Check authentication state
            auth.onAuthStateChanged(user => {
                currentUser = user;
                updateAuthUI();
                if (user) {
                    loadUserData();
                }
            });

            // Load cart from memory (no localStorage in artifacts)
            cart = [];
            updateCartUI();
        }

        function setupEventListeners() {
    // Auth Modal
    elements.accountBtn.addEventListener('click', (e) => {
        e.preventDefault();
        showAuthModal();
    });
    
    document.getElementById('becomeSellerBtn').addEventListener('click', (e) => {
        e.preventDefault();
        handleBecomeSellerClick();
    });
    
    elements.authSwitchBtn.addEventListener('click', switchAuthMode);
    elements.authForm.addEventListener('submit', handleAuthSubmit);
    document.getElementById('authModalClose').addEventListener('click', () => hideModal('authModal'));

    // Cart
    elements.cartBtn.addEventListener('click', (e) => {
        e.preventDefault();
        toggleCart();
    });
    
    document.getElementById('cartCloseBtn').addEventListener('click', toggleCart);
    document.getElementById('checkoutBtn').addEventListener('click', proceedToCheckout);

    // Search
    elements.searchForm.addEventListener('submit', handleSearch);

    // Seller Dashboard
    elements.sellerBtn.addEventListener('click', (e) => {
        e.preventDefault();
        toggleSellerDashboard();
    });
    
    elements.addProductBtn.addEventListener('click', showProductForm);
    document.getElementById('cancelProductBtn').addEventListener('click', hideProductForm);
    elements.productForm.addEventListener('submit', handleAddProduct);
    document.getElementById('manageSubscriptionBtn').addEventListener('click', showSubscriptionModal);

    // Subscription
    elements.subscribeBtn.addEventListener('click', handleSubscription);
    document.getElementById('subscriptionClose').addEventListener('click', () => hideModal('subscriptionModal'));

    // Filters
    elements.categoryFilter.addEventListener('change', applyFilters);
    elements.sortFilter.addEventListener('change', applyFilters);
    elements.priceFilter.addEventListener('change', applyFilters);

    // Product actions (event delegation)
    elements.productsGrid.addEventListener('click', handleProductClick);

    // Modal close on outside click
    window.addEventListener('click', handleModalOutsideClick);

    // Navigation categories - FIX THIS
    document.querySelectorAll('.nav-item[data-category]').forEach(item => {
        item.addEventListener('click', (e) => {
            e.preventDefault();
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            // Add active class to clicked item
            item.classList.add('active');
            filterByCategory(item.dataset.category);
        });
    });
    
    // Home button
    document.querySelector('.nav-item:not([data-category])').addEventListener('click', (e) => {
        e.preventDefault();
        document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
        e.target.classList.add('active');
        elements.categoryFilter.value = '';
        applyFilters();
    });
    
    // Footer links - add functionality
    setupFooterLinks();
    
    // Category cards
    setupCategoryCards();
        }

        async function loadInitialData() {
            try {
                showLoading(true);
                await Promise.all([
                    loadCategories(),
                    loadProducts()
                ]);
                showLoading(false);
            } catch (error) {
                console.error('Error loading initial data:', error);
                showAlert('Failed to load data. Please refresh the page.', 'error');
                showLoading(false);
            }
        }

        // ======================
        // AUTHENTICATION FUNCTIONS
        // ======================
        function showAuthModal() {
    if (currentUser) {
        showUserMenu();
    } else {
        showModal('authModal');
    }
        }

        function switchAuthMode() {
            currentAuthMode = currentAuthMode === 'signin' ? 'signup' : 'signin';
            
            if (currentAuthMode === 'signup') {
                elements.authTitle.textContent = 'Create Account';
                elements.authSubtitle.textContent = 'Join thousands of sellers and buyers';
                elements.authSubmitBtn.textContent = 'Create Account';
                elements.authSwitchText.textContent = 'Already have an account?';
                elements.authSwitchBtn.textContent = 'Sign in';
                elements.confirmPasswordGroup.style.display = 'block';
                elements.profileFieldsGroup.style.display = 'block';
                elements.authForm.confirmPassword.required = true;
                elements.authForm.firstName.required = true;
                elements.authForm.lastName.required = true;
            } else {
                elements.authTitle.textContent = 'Welcome Back';
                elements.authSubtitle.textContent = 'Sign in to your account';
                elements.authSubmitBtn.textContent = 'Sign In';
                elements.authSwitchText.textContent = "Don't have an account?";
                elements.authSwitchBtn.textContent = 'Sign up';
                elements.confirmPasswordGroup.style.display = 'none';
                elements.profileFieldsGroup.style.display = 'none';
                elements.authForm.confirmPassword.required = false;
                elements.authForm.firstName.required = false;
                elements.authForm.lastName.required = false;
            }
        }

        async function handleAuthSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const email = formData.get('email');
            const password = formData.get('password');
            
            try {
                showLoading(true, elements.authSubmitBtn);
                
                if (currentAuthMode === 'signup') {
                    const confirmPassword = formData.get('confirmPassword');
                    const firstName = formData.get('firstName');
                    const lastName = formData.get('lastName');
                    
                    if (password !== confirmPassword) {
                        throw new Error('Passwords do not match');
                    }
                    
                    // Create user account
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    const user = userCredential.user;
                    
                    // Create user profile
                    await db.collection('users').doc(user.uid).set({
                        email: email,
                        firstName: firstName,
                        lastName: lastName,
                        displayName: `${firstName} ${lastName}`,
                        isSeller: false,
                        sellerSubscription: null,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        address: {
                            street: '',
                            city: '',
                            state: '',
                            zipCode: '',
                            country: ''
                        },
                        paymentMethods: []
                    });
                    
                    await sendWelcomeEmail(user, firstName);
                    showAlert('Account created successfully! Welcome to WEB VTEC!', 'success');
                    
                } else {
                    // Sign in
                    await auth.signInWithEmailAndPassword(email, password);
                    showAlert('Welcome back!', 'success');
                }
                
                hideModal('authModal');
                elements.authForm.reset();
                
            } catch (error) {
                console.error('Authentication error:', error);
                showAlert(getFirebaseErrorMessage(error), 'error');
            } finally {
                showLoading(false, elements.authSubmitBtn);
            }
        }

        async function signOut() {
            try {
                await auth.signOut();
                cart = [];
                userProfile = null;
                sellerSubscription = null;
                isSellerMode = false;
                updateCartUI();
                hideSellerDashboard();
                showAlert('Signed out successfully', 'success');
            } catch (error) {
                console.error('Sign out error:', error);
                showAlert('Error signing out', 'error');
            }
        }

        function updateAuthUI() {
            if (currentUser) {
                elements.accountText.textContent = 'Account';
                elements.accountBtn.innerHTML = `
                    <i class="fas fa-user-circle"></i>
                    <span>Hi, ${userProfile?.firstName || 'User'}</span>
                `;
            } else {
                elements.accountText.textContent = 'Sign In';
                elements.accountBtn.innerHTML = `
                    <i class="fas fa-user"></i>
                    <span>Account</span>
                `;
            }
        }

        async function loadUserData() {
            if (!currentUser) return;
            
            try {
                // Load user profile
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists) {
                    userProfile = userDoc.data();
                    updateAuthUI();
                }
                
                // Load seller subscription if user is a seller
                if (userProfile?.isSeller) {
                    const subscriptionDoc = await db.collection('subscriptions')
                        .where('userId', '==', currentUser.uid)
                        .where('status', '==', 'active')
                        .limit(1)
                        .get();
                    
                    if (!subscriptionDoc.empty) {
                        sellerSubscription = subscriptionDoc.docs[0].data();
                    }
                }
                
                // Load user's cart from Firestore
                const cartDoc = await db.collection('carts').doc(currentUser.uid).get();
                if (cartDoc.exists) {
                    cart = cartDoc.data().items || [];
                    updateCartUI();
                }
                
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        function showUserMenu() {
    // Remove any existing menu
    const existingMenu = document.querySelector('.user-menu');
    if (existingMenu) existingMenu.remove();
    
    const menu = document.createElement('div');
    menu.className = 'user-menu';
    menu.style.cssText = `
        position: absolute;
        top: 100%;
        right: 0;
        background: white;
        border: 1px solid var(--border);
        border-radius: 8px;
        box-shadow: var(--shadow-lg);
        min-width: 200px;
        z-index: 1000;
        margin-top: 8px;
    `;
    
    menu.innerHTML = `
        <div style="padding: 16px; border-bottom: 1px solid var(--border);">
            <div style="font-weight: 600;">${userProfile?.displayName || 'User'}</div>
            <div style="font-size: 0.9rem; color: var(--text-secondary);">${currentUser?.email}</div>
        </div>
        <div style="padding: 8px 0;">
            <a href="#" id="viewProfile" style="display: block; padding: 12px 16px; text-decoration: none; color: var(--text-primary);">
                <i class="fas fa-user" style="margin-right: 8px;"></i> View Profile
            </a>
            <a href="#" id="orderHistory" style="display: block; padding: 12px 16px; text-decoration: none; color: var(--text-primary);">
                <i class="fas fa-box" style="margin-right: 8px;"></i> Order History
            </a>
            <a href="#" id="signOutBtn" style="display: block; padding: 12px 16px; text-decoration: none; color: var(--error);">
                <i class="fas fa-sign-out-alt" style="margin-right: 8px;"></i> Sign Out
            </a>
        </div>
    `;
    
    elements.accountBtn.style.position = 'relative';
    elements.accountBtn.appendChild(menu);
    
    // Event listeners for menu items
    menu.querySelector('#viewProfile').addEventListener('click', (e) => {
        e.preventDefault();
        showProfileModal();
        menu.remove();
    });
    
    menu.querySelector('#orderHistory').addEventListener('click', (e) => {
        e.preventDefault();
        showOrderHistory();
        menu.remove();
    });
    
    menu.querySelector('#signOutBtn').addEventListener('click', (e) => {
        e.preventDefault();
        signOut();
        menu.remove();
    });
    
    // Close menu when clicking outside
    setTimeout(() => {
        document.addEventListener('click', function closeMenu(e) {
            if (!menu.contains(e.target) && !elements.accountBtn.contains(e.target)) {
                menu.remove();
                document.removeEventListener('click', closeMenu);
            }
        });
    }, 0);
        }

        // ======================
        // PRODUCT FUNCTIONS
        // ======================
        async function loadCategories() {
            try {
                // In a real implementation, load from Firestore
                // const categoriesSnapshot = await db.collection('categories').get();
                // categories = categoriesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                // For demo, use sample data
                categories = sampleCategories;
                renderCategories();
                populateCategoryFilter();
                
            } catch (error) {
                console.error('Error loading categories:', error);
                categories = sampleCategories; // Fallback to sample data
                renderCategories();
                populateCategoryFilter();
            }
        }

        async function loadProducts() {
            try {
                // In a real implementation:
                const productsSnapshot = await db.collection('products')
                    .where('isActive', '==', true)
                    .orderBy('createdAt', 'desc')
                    .limit(50)
                    .get();
                
                products = productsSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                renderProducts(products);
                
            } catch (error) {
                console.error('Error loading products:', error);
                // Load sample products for demo
                products = await generateSampleProducts();
                renderProducts(products);
            }
        }

        function renderCategories() {
            elements.categoriesGrid.innerHTML = categories.map(category => `
                <a href="#" class="category-card" data-category="${category.id}">
                    <div class="category-icon">
                        <i class="${category.icon}"></i>
                    </div>
                    <div class="category-name">${category.name}</div>
                    <div class="category-count">${category.count} products</div>
                </a>
            `).join('');
        }

        function renderProducts(productsToRender) {
            if (productsToRender.length === 0) {
                elements.productsGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px;">
                        <i class="fas fa-search" style="font-size: 3rem; color: var(--text-muted); margin-bottom: 16px;"></i>
                        <h3 style="margin-bottom: 8px;">No products found</h3>
                        <p style="color: var(--text-secondary);">Try adjusting your filters or search terms</p>
                    </div>
                `;
                return;
            }

            elements.productsGrid.innerHTML = productsToRender.map(product => `
                <div class="product-card" data-product-id="${product.id}">
                    <div class="product-image">
                        ${product.badge ? `<div class="product-badge">${product.badge}</div>` : ''}
                        <img src="${product.image}" alt="${product.title}" loading="lazy">
                    </div>
                    <div class="product-info">
                        <h3 class="product-title">${product.title}</h3>
                        <div class="product-seller">by ${product.sellerName}</div>
                        <div class="product-rating">
                            <div class="stars">
                                ${generateStars(product.rating)}
                            </div>
                            <span class="rating-text">(${product.reviews})</span>
                        </div>
                        <div class="product-price">
                            $${product.price}
                            ${product.originalPrice ? `<span class="product-original-price">$${product.originalPrice}</span>` : ''}
                        </div>
                        <div class="product-shipping">${product.shipping}</div>
                        <div class="product-actions">
                            <button class="btn btn-primary add-to-cart" data-product-id="${product.id}">
                                <i class="fas fa-cart-plus"></i>
                                Add to Cart
                            </button>
                            <button class="btn btn-secondary view-product" data-product-id="${product.id}">
                                <i class="fas fa-eye"></i>
                                View
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function generateStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 !== 0;
            const emptyStars = 5 - Math.ceil(rating);
            
            let stars = '';
            for (let i = 0; i < fullStars; i++) {
                stars += '<i class="fas fa-star star"></i>';
            }
            if (hasHalfStar) {
                stars += '<i class="fas fa-star-half-alt star"></i>';
            }
            for (let i = 0; i < emptyStars; i++) {
                stars += '<i class="far fa-star star empty"></i>';
            }
            return stars;
        }

        function populateCategoryFilter() {
            elements.categoryFilter.innerHTML = `
                <option value="">All Categories</option>
                ${categories.map(cat => `<option value="${cat.id}">${cat.name}</option>`).join('')}
            `;
        }

        

        function handleProductClick(e) {
            const target = e.target;
            const productCard = target.closest('.product-card');
            if (!productCard) return;
            
            const productId = productCard.dataset.productId;
            
            if (target.classList.contains('add-to-cart')) {
                e.preventDefault();
                addToCart(productId);
            } else if (target.classList.contains('view-product')) {
                e.preventDefault();
                showProductModal(productId);
            }
        }

        async function addToCart(productId) {
            try {
                const product = products.find(p => p.id === productId);
                if (!product) {
                    throw new Error('Product not found');
                }
                
                // Check if product already in cart
                const existingItem = cart.find(item => item.id === productId);
                
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({
                        id: productId,
                        title: product.title,
                        price: product.price,
                        image: product.image,
                        sellerName: product.sellerName,
                        quantity: 1
                    });
                }
                
                updateCartUI();
                
                // Save cart to Firestore if user is logged in
                if (currentUser) {
                    await db.collection('carts').doc(currentUser.uid).set({
                        items: cart,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
                
                showAlert('Product added to cart!', 'success');
                
            } catch (error) {
                console.error('Error adding to cart:', error);
                showAlert('Failed to add product to cart', 'error');
            }
        }

        async function showProductModal(productId) {
            try {
                const product = products.find(p => p.id === productId);
                if (!product) return;
                
                // Load product reviews
                const reviewsSnapshot = await db.collection('reviews')
                    .where('productId', '==', productId)
                    .orderBy('createdAt', 'desc')
                    .limit(10)
                    .get();
                
                const reviews = reviewsSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.id = 'productModal';
                
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 900px;">
                        <button class="modal-close" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i>
                        </button>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px; margin-bottom: 32px;">
                            <div>
                                <img src="${product.image}" alt="${product.title}" 
                                     style="width: 100%; border-radius: 12px;">
                            </div>
                            <div>
                                <h2 style="font-size: 1.75rem; margin-bottom: 16px;">${product.title}</h2>
                                <div style="margin-bottom: 16px;">
                                    <div class="product-rating">
                                        <div class="stars">${generateStars(product.rating)}</div>
                                        <span class="rating-text">(${product.reviews} reviews)</span>
                                    </div>
                                </div>
                                <div style="font-size: 2rem; font-weight: 700; color: var(--primary); margin-bottom: 16px;">
                                    $${product.price}
                                    ${product.originalPrice ? `<span style="font-size: 1.2rem; text-decoration: line-through; color: var(--text-secondary); margin-left: 8px;">$${product.originalPrice}</span>` : ''}
                                </div>
                                <div style="color: var(--success); margin-bottom: 24px; font-weight: 500;">
                                    ${product.shipping}
                                </div>
                                <div style="margin-bottom: 24px;">
                                    <h4 style="margin-bottom: 8px;">Description</h4>
                                    <p style="color: var(--text-secondary);">${product.description}</p>
                                </div>
                                <div style="margin-bottom: 24px;">
                                    <strong>Seller:</strong> ${product.sellerName}<br>
                                    <strong>Stock:</strong> ${product.stock} available
                                </div>
                                <button class="btn btn-primary btn-lg" onclick="addToCart('${product.id}'); this.closest('.modal').remove();">
                                    <i class="fas fa-cart-plus"></i>
                                    Add to Cart - $${product.price}
                                </button>
                            </div>
                        </div>
                        
                        <div style="border-top: 1px solid var(--border); padding-top: 32px;">
                            <h3 style="margin-bottom: 24px;">Customer Reviews</h3>
                            <div id="reviewsList">
                                ${reviews.length === 0 ? 
                                    '<p style="color: var(--text-secondary); text-align: center; padding: 40px;">No reviews yet. Be the first to review this product!</p>' :
                                    reviews.map(review => `
                                        <div style="border-bottom: 1px solid var(--border-light); padding-bottom: 16px; margin-bottom: 16px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                                <div>
                                                    <strong>${review.userName}</strong>
                                                    <div class="stars" style="margin-left: 8px; display: inline-block;">
                                                        ${generateStars(review.rating)}
                                                    </div>
                                                </div>
                                                <div style="color: var(--text-secondary); font-size: 0.9rem;">
                                                    ${new Date(review.createdAt?.toDate()).toLocaleDateString()}
                                                </div>
                                            </div>
                                            <p style="color: var(--text-secondary);">${review.comment}</p>
                                        </div>
                                    `).join('')
                                }
                            </div>
                            ${currentUser ? `
                                <div style="margin-top: 24px; padding: 24px; background: var(--background-light); border-radius: 12px;">
                                    <h4 style="margin-bottom: 16px;">Write a Review</h4>
                                    <form id="reviewForm" data-product-id="${product.id}">
                                        <div style="margin-bottom: 16px;">
                                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Rating</label>
                                            <div class="rating-input" style="display: flex; gap: 4px;">
                                                ${[1,2,3,4,5].map(star => `
                                                    <i class="fas fa-star rating-star" data-rating="${star}" 
                                                       style="font-size: 1.5rem; color: var(--border); cursor: pointer; transition: color 0.2s;"></i>
                                                `).join('')}
                                            </div>
                                        </div>
                                        <div style="margin-bottom: 16px;">
                                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Your Review</label>
                                            <textarea name="comment" rows="4" style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px;" placeholder="Share your experience with this product..."></textarea>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Submit Review</button>
                                    </form>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Setup review form if user is logged in
                if (currentUser) {
                    setupReviewForm(modal, product.id);
                }
                
            } catch (error) {
                console.error('Error showing product modal:', error);
                showAlert('Error loading product details', 'error');
            }
        }

        function setupReviewForm(modal, productId) {
            const reviewForm = modal.querySelector('#reviewForm');
            const ratingStars = modal.querySelectorAll('.rating-star');
            let selectedRating = 0;
            
            // Rating star interactions
            ratingStars.forEach(star => {
                star.addEventListener('mouseover', () => {
                    const rating = parseInt(star.dataset.rating);
                    ratingStars.forEach((s, index) => {
                        s.style.color = index < rating ? 'var(--accent)' : 'var(--border)';
                    });
                });
                
                star.addEventListener('mouseout', () => {
                    ratingStars.forEach((s, index) => {
                        s.style.color = index < selectedRating ? 'var(--accent)' : 'var(--border)';
                    });
                });
                
                star.addEventListener('click', () => {
                    selectedRating = parseInt(star.dataset.rating);
                    ratingStars.forEach((s, index) => {
                        s.style.color = index < selectedRating ? 'var(--accent)' : 'var(--border)';
                    });
                });
            });
            
            // Review form submission
            reviewForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                if (selectedRating === 0) {
                    showAlert('Please select a rating', 'error');
                    return;
                }
                
                const formData = new FormData(e.target);
                const comment = formData.get('comment').trim();
                
                if (!comment) {
                    showAlert('Please write a review', 'error');
                    return;
                }
                
                try {
                    await submitReview(productId, selectedRating, comment);
                    showAlert('Review submitted successfully!', 'success');
                    modal.remove();
                } catch (error) {
                    console.error('Error submitting review:', error);
                    showAlert('Failed to submit review', 'error');
                }
            });
        }

        async function submitReview(productId, rating, comment) {
            if (!currentUser) throw new Error('User not authenticated');
            
            const review = {
                productId: productId,
                userId: currentUser.uid,
                userName: userProfile?.displayName || 'Anonymous User',
                rating: rating,
                comment: comment,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            // Add review to Firestore
            await db.collection('reviews').add(review);
            
            // Update product rating (you'd typically do this with Cloud Functions)
            // This is a simplified version
            const reviewsSnapshot = await db.collection('reviews')
                .where('productId', '==', productId)
                .get();
            
            const reviews = reviewsSnapshot.docs.map(doc => doc.data());
            const avgRating = reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length;
            
            await db.collection('products').doc(productId).update({
                rating: Math.round(avgRating * 10) / 10,
                reviews: reviews.length
            });
        }

        // ======================
        // CART FUNCTIONS
        // ======================
        function updateCartUI() {
            const itemCount = cart.reduce((total, item) => total + item.quantity, 0);
            elements.cartCount.textContent = itemCount;
            elements.cartCount.style.display = itemCount > 0 ? 'flex' : 'none';
            
            if (cart.length === 0) {
                elements.cartItems.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">
                        <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 16px; opacity: 0.3;"></i>
                        <p style="font-size: 1.1rem; margin-bottom: 8px;">Your cart is empty</p>
                        <p style="font-size: 0.9rem;">Add some amazing products!</p>
                    </div>
                `;
                elements.cartFooter.style.display = 'none';
            } else {
                renderCartItems();
                updateCartTotals();
                elements.cartFooter.style.display = 'block';
            }
        }

        function renderCartItems() {
            elements.cartItems.innerHTML = cart.map(item => `
                <div class="cart-item" data-item-id="${item.id}">
                    <div class="cart-item-image">
                        <img src="${item.image}" alt="${item.title}">
                    </div>
                    <div class="cart-item-info">
                        <div class="cart-item-title">${item.title}</div>
                        <div class="cart-item-price">${item.price}</div>
                        <div class="cart-item-controls">
                            <button class="qty-btn" onclick="updateCartQuantity('${item.id}', -1)">-</button>
                            <input type="number" class="qty-input" value="${item.quantity}" min="1" 
                                   onchange="updateCartQuantity('${item.id}', 0, this.value)">
                            <button class="qty-btn" onclick="updateCartQuantity('${item.id}', 1)">+</button>
                            <button class="remove-btn" onclick="removeFromCart('${item.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateCartTotals() {
    const subtotal = cart.reduce((total, item) => total + (parseFloat(item.price) * item.quantity), 0);
    const total = subtotal; // Remove shipping logic since sellers handle it
    
    elements.cartSubtotal.textContent = `$${subtotal.toFixed(2)}`;
    elements.cartTotal.textContent = `$${total.toFixed(2)}`;
    
    // Update shipping text
    const shippingElement = document.querySelector('.cart-shipping span:last-child');
    if (shippingElement) {
        shippingElement.textContent = 'By Seller';
    }
        }

        async function updateCartQuantity(itemId, change, newValue = null) {
            const item = cart.find(i => i.id === itemId);
            if (!item) return;
            
            if (newValue !== null) {
                item.quantity = Math.max(1, parseInt(newValue));
            } else {
                item.quantity = Math.max(1, item.quantity + change);
            }
            
            updateCartUI();
            
            // Save to Firestore if user is logged in
            if (currentUser) {
                await db.collection('carts').doc(currentUser.uid).set({
                    items: cart,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            }
        }

        async function removeFromCart(itemId) {
            cart = cart.filter(item => item.id !== itemId);
            updateCartUI();
            
            // Save to Firestore if user is logged in
            if (currentUser) {
                await db.collection('carts').doc(currentUser.uid).set({
                    items: cart,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            }
            
            showAlert('Item removed from cart', 'info');
        }

        function toggleCart() {
            elements.cartSidebar.classList.toggle('active');
        }

        // ======================
        // SELLER FUNCTIONS
        // ======================
        function handleBecomeSellerClick() {
            if (!currentUser) {
                showAuthModal();
                return;
            }
            
            if (userProfile?.isSeller && sellerSubscription?.status === 'active') {
                toggleSellerDashboard();
            } else {
                showSubscriptionModal();
            }
        }

        function toggleSellerDashboard() {
            isSellerMode = !isSellerMode;
            
            if (isSellerMode) {
                elements.sellerDashboard.classList.add('active');
                loadSellerDashboard();
            } else {
                hideSellerDashboard();
            }
        }

        function hideSellerDashboard() {
            elements.sellerDashboard.classList.remove('active');
            hideProductForm();
            isSellerMode = false;
        }

        async function loadSellerDashboard() {
            if (!currentUser || !userProfile?.isSeller) return;
            
            try {
                // Load seller stats
                const [ordersSnapshot, productsSnapshot, revenueSnapshot] = await Promise.all([
                    db.collection('orders').where('sellerId', '==', currentUser.uid).get(),
                    db.collection('products').where('sellerId', '==', currentUser.uid).get(),
                    db.collection('orders')
                        .where('sellerId', '==', currentUser.uid)
                        .where('status', '==', 'completed')
                        .get()
                ]);
                
                const totalOrders = ordersSnapshot.size;
                const totalProducts = productsSnapshot.size;
                const totalRevenue = revenueSnapshot.docs.reduce((sum, doc) => {
                    return sum + (doc.data().total || 0);
                }, 0);
                
                renderSellerStats({
                    totalProducts,
                    totalOrders,
                    totalRevenue: totalRevenue.toFixed(2),
                    subscriptionStatus: sellerSubscription?.status || 'inactive'
                });
                
                // Load seller products
                const sellerProducts = productsSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                renderSellerProducts(sellerProducts);
                
            } catch (error) {
                console.error('Error loading seller dashboard:', error);
                showAlert('Error loading dashboard data', 'error');
            }
        }

        function renderSellerStats(stats) {
            elements.dashboardStats.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${stats.totalProducts}</div>
                    <div class="stat-label">Products Listed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.totalOrders}</div>
                    <div class="stat-label">Total Orders</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.totalRevenue}</div>
                    <div class="stat-label">Total Revenue</div>
                </div>
                <div class="stat-card" style="background: ${stats.subscriptionStatus === 'active' ? 'var(--success)' : 'var(--error)'};">
                    <div class="stat-value">${stats.subscriptionStatus === 'active' ? 'ACTIVE' : 'INACTIVE'}</div>
                    <div class="stat-label">Subscription</div>
                </div>
            `;
        }

        function renderSellerProducts(sellerProducts) {
            if (sellerProducts.length === 0) {
                elements.sellerProductsList.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">
                        <i class="fas fa-box-open" style="font-size: 3rem; margin-bottom: 16px; opacity: 0.3;"></i>
                        <h3 style="margin-bottom: 8px;">No products yet</h3>
                        <p style="margin-bottom: 16px;">Start selling by adding your first product</p>
                        <button class="btn btn-primary" onclick="showProductForm()">
                            <i class="fas fa-plus"></i> Add Product
                        </button>
                    </div>
                `;
                return;
            }
            
            elements.sellerProductsList.innerHTML = `
                <div style="display: grid; gap: 16px;">
                    ${sellerProducts.map(product => `
                        <div class="seller-product-item" style="display: flex; gap: 16px; padding: 16px; border: 1px solid var(--border); border-radius: 12px;">
                            <img src="${product.image}" alt="${product.title}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;">
                            <div style="flex: 1;">
                                <h4 style="margin-bottom: 8px;">${product.title}</h4>
                                <div style="color: var(--text-secondary); margin-bottom: 8px;">
                                    Price: ${product.price} • Stock: ${product.stock} • 
                                    Status: <span style="color: ${product.isActive ? 'var(--success)' : 'var(--error)'}">
                                        ${product.isActive ? 'Active' : 'Inactive'}
                                    </span>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <button class="btn btn-sm btn-secondary" onclick="editProduct('${product.id}')">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="btn btn-sm ${product.isActive ? 'btn-danger' : 'btn-success'}" 
                                            onclick="toggleProductStatus('${product.id}', ${!product.isActive})">
                                        <i class="fas fa-${product.isActive ? 'pause' : 'play'}"></i> 
                                        ${product.isActive ? 'Deactivate' : 'Activate'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function showProductForm() {
            elements.productFormContainer.classList.add('active');
            elements.productFormContainer.scrollIntoView({ behavior: 'smooth' });
        }

        function hideProductForm() {
            elements.productFormContainer.classList.remove('active');
            elements.productForm.reset();
        }

        async function handleAddProduct(e) {
            e.preventDefault();
            
            if (!currentUser || !userProfile?.isSeller) {
                showAlert('You must be a subscribed seller to add products', 'error');
                return;
            }
            
            try {
                showLoading(true, e.target.querySelector('button[type="submit"]'));
                
                const formData = new FormData(e.target);
                const images = formData.getAll('images');
                
                if (images.length === 0 || !images[0].name) {
                    throw new Error('Please select at least one product image');
                }
                
                // Upload images to Firebase Storage
                const imageUrls = [];
                for (let i = 0; i < Math.min(images.length, 5); i++) {
                    const image = images[i];
                    const imageRef = storage.ref(`products/${currentUser.uid}/${Date.now()}_${i}`);
                    const snapshot = await imageRef.put(image);
                    const url = await snapshot.ref.getDownloadURL();
                    imageUrls.push(url);
                }
                
                // Create product document
                const productData = {
                    title: formData.get('title'),
                    description: formData.get('description'),
                    price: parseFloat(formData.get('price')).toFixed(2),
                    category: formData.get('category'),
                    condition: formData.get('condition'),
                    stock: parseInt(formData.get('stock')),
                    weight: parseFloat(formData.get('weight')) || 0,
                    shippingTime: formData.get('shippingTime'),
                    brand: formData.get('brand') || '',
                    images: imageUrls,
                    image: imageUrls[0], // Main image
                    sellerId: currentUser.uid,
                    sellerName: userProfile.displayName,
                    isActive: true,
                    rating: 0,
                    reviews: 0,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Add shipping info based on time
                const shippingMap = {
                    '1-2': 'FREE overnight shipping',
                    '3-5': 'FREE shipping in 3-5 days',
                    '5-7': 'FREE shipping in 5-7 days',
                    '7-14': 'FREE shipping in 1-2 weeks',
                    '14+': 'Standard shipping (2+ weeks)'
                };
                productData.shipping = shippingMap[productData.shippingTime];
                
                // Save to Firestore
                await db.collection('products').add(productData);
                
                showAlert('Product added successfully!', 'success');
                hideProductForm();
                loadSellerDashboard(); // Refresh dashboard
                loadProducts(); // Refresh main product list
                
            } catch (error) {
                console.error('Error adding product:', error);
                showAlert(error.message || 'Failed to add product', 'error');
            } finally {
                showLoading(false, e.target.querySelector('button[type="submit"]'));
            }
        }

        async function toggleProductStatus(productId, isActive) {
            try {
                await db.collection('products').doc(productId).update({
                    isActive: isActive,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showAlert(`Product ${isActive ? 'activated' : 'deactivated'} successfully`, 'success');
                loadSellerDashboard();
                
            } catch (error) {
                console.error('Error updating product status:', error);
                showAlert('Failed to update product status', 'error');
            }
        }

        // ======================
        // SUBSCRIPTION FUNCTIONS
        // ======================
        function showSubscriptionModal() {
            showModal('subscriptionModal');
        }

        async function handleSubscription() {
            if (!currentUser) {
                showAlert('Please sign in to subscribe', 'error');
                return;
            }
            
            try {
                showLoading(true, elements.subscribeBtn);
                
                // Create Stripe checkout session
                const createCheckoutSession = functions.httpsCallable('createCheckoutSession');
                const result = await createCheckoutSession({
                    priceId: 'price_seller_subscription_monthly', // Replace with your Stripe price ID
                    successUrl: window.location.origin + '?subscription=success',
                    cancelUrl: window.location.origin + '?subscription=cancelled'
                });
                
                // Redirect to Stripe Checkout
                const { error } = await stripe.redirectToCheckout({
                    sessionId: result.data.sessionId
                });
                
                if (error) {
                    throw error;
                }
                
            } catch (error) {
                console.error('Subscription error:', error);
                showAlert('Failed to start subscription process', 'error');
            } finally {
                showLoading(false, elements.subscribeBtn);
            }
        }

        // Handle subscription success/failure from URL params
        function handleSubscriptionResult() {
            const urlParams = new URLSearchParams(window.location.search);
            const subscriptionResult = urlParams.get('subscription');
            
            if (subscriptionResult === 'success') {
                showAlert('Subscription activated! Welcome to WEB VTEC sellers!', 'success');
                // Refresh user data to get updated subscription status
                loadUserData();
                // Clean URL
                window.history.replaceState({}, document.title, window.location.pathname);
            } else if (subscriptionResult === 'cancelled') {
                showAlert('Subscription cancelled', 'info');
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }

        // ======================
        // CHECKOUT FUNCTIONS
        // ======================
        async function proceedToCheckout() {
            if (!currentUser) {
                showAlert('Please sign in to checkout', 'error');
                showAuthModal();
                return;
            }
            
            if (cart.length === 0) {
                showAlert('Your cart is empty', 'error');
                return;
            }
            
            showCheckoutModal();
        }

        function showCheckoutModal() {
            const subtotal = cart.reduce((total, item) => total + (parseFloat(item.price) * item.quantity), 0);
            const shipping = subtotal >= 75 ? 0 : 9.99;
            const total = subtotal + shipping;
            
            elements.checkoutContent.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px;">
                    <div>
                        <h3 style="margin-bottom: 24px;">Shipping Information</h3>
                        <form id="checkoutForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">First Name *</label>
                                    <input type="text" class="form-input" name="firstName" required 
                                           value="${userProfile?.firstName || ''}">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Last Name *</label>
                                    <input type="text" class="form-input" name="lastName" required
                                           value="${userProfile?.lastName || ''}">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Email Address *</label>
                                <input type="email" class="form-input" name="email" required
                                       value="${currentUser?.email || ''}">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Street Address *</label>
                                <input type="text" class="form-input" name="street" required
                                       value="${userProfile?.address?.street || ''}" placeholder="123 Main Street">
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">City *</label>
                                    <input type="text" class="form-input" name="city" required
                                           value="${userProfile?.address?.city || ''}">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">State *</label>
                                    <input type="text" class="form-input" name="state" required
                                           value="${userProfile?.address?.state || ''}">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">ZIP Code *</label>
                                    <input type="text" class="form-input" name="zipCode" required
                                           value="${userProfile?.address?.zipCode || ''}">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Country *</label>
                                    <select class="form-select" name="country" required>
                                        <option value="US" ${userProfile?.address?.country === 'US' ? 'selected' : ''}>United States</option>
                                        <option value="CA" ${userProfile?.address?.country === 'CA' ? 'selected' : ''}>Canada</option>
                                        <option value="GB" ${userProfile?.address?.country === 'GB' ? 'selected' : ''}>United Kingdom</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div style="margin: 32px 0;">
                                <h4 style="margin-bottom: 16px;">Payment Method</h4>
                                <div id="card-element" style="padding: 16px; border: 1px solid var(--border); border-radius: 8px; background: white;">
                                    <!-- Stripe Elements will create form elements here -->
                                </div>
                                <div id="card-errors" role="alert" style="color: var(--error); margin-top: 8px;"></div>
                            </div>
                        </form>
                    </div>
                    
                    <div>
                        <h3 style="margin-bottom: 24px;">Order Summary</h3>
                        <div style="border: 1px solid var(--border); border-radius: 12px; padding: 24px;">
                            ${cart.map(item => `
                                <div style="display: flex; justify-content: space-between; margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--border-light);">
                                    <div>
                                        <div style="font-weight: 600;">${item.title}</div>
                                        <div style="color: var(--text-secondary); font-size: 0.9rem;">Qty: ${item.quantity}</div>
                                    </div>
                                    <div style="font-weight: 600;">${(parseFloat(item.price) * item.quantity).toFixed(2)}</div>
                                </div>
                            `).join('')}
                            
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>Subtotal:</span>
                                <span>${subtotal.toFixed(2)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>Shipping:</span>
                                <span>${shipping === 0 ? 'FREE' : ' + shipping.toFixed(2)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 1.25rem; font-weight: 700; padding-top: 16px; border-top: 1px solid var(--border);">
                                <span>Total:</span>
                                <span>${total.toFixed(2)}</span>
                            </div>
                            
                            <button type="button" class="btn btn-primary btn-lg" id="payNowBtn" style="width: 100%; margin-top: 24px;">
                                <i class="fas fa-lock"></i>
                                Complete Order - ${total.toFixed(2)}
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            showModal('checkoutModal');
            setupStripeElements();
        }

        function setupStripeElements() {
            const elements = stripe.elements();
            const card = elements.create('card', {
                style: {
                    base: {
                        fontSize: '16px',
                        color: '#424770',
                        '::placeholder': {
                            color: '#aab7c4',
                        },
                    },
                    invalid: {
                        color: '#9e2146',
                    },
                },
            });
            
            card.mount('#card-element');
            
            card.on('change', ({error}) => {
                const displayError = document.getElementById('card-errors');
                if (error) {
                    displayError.textContent = error.message;
                } else {
                    displayError.textContent = '';
                }
            });
            
            document.getElementById('payNowBtn').addEventListener('click', () => handlePayment(card));
        }

        async function handlePayment(card) {
            const checkoutForm = document.getElementById('checkoutForm');
            const payNowBtn = document.getElementById('payNowBtn');
            
            try {
                showLoading(true, payNowBtn);
                
                const formData = new FormData(checkoutForm);
                const shippingAddress = {
                    name: `${formData.get('firstName')} ${formData.get('lastName')}`,
                    email: formData.get('email'),
                    street: formData.get('street'),
                    city: formData.get('city'),
                    state: formData.get('state'),
                    zipCode: formData.get('zipCode'),
                    country: formData.get('country')
                };
                
                // Create payment intent
                const createPaymentIntent = functions.httpsCallable('createPaymentIntent');
                const paymentIntentResult = await createPaymentIntent({
                    amount: cart.reduce((total, item) => total + (parseFloat(item.price) * item.quantity), 0) * 100, // Convert to cents
                    currency: 'usd',
                    shipping: shippingAddress,
                    items: cart
                });
                
                const {error, paymentIntent} = await stripe.confirmCardPayment(
                    paymentIntentResult.data.clientSecret,
                    {
                        payment_method: {
                            card: card,
                            billing_details: {
                                name: shippingAddress.name,
                                email: shippingAddress.email,
                                address: {
                                    line1: shippingAddress.street,
                                    city: shippingAddress.city,
                                    state: shippingAddress.state,
                                    postal_code: shippingAddress.zipCode,
                                    country: shippingAddress.country
                                }
                            }
                        }
                    }
                );
                
                if (error) {
                    throw error;
                }
                
                if (paymentIntent.status === 'succeeded') {
                    await processOrder(paymentIntent, shippingAddress);
                    showAlert('Order placed successfully! Check your email for confirmation.', 'success');
                    hideModal('checkoutModal');
                    cart = [];
                    updateCartUI();
                    toggleCart();
                }
                
            } catch (error) {
                console.error('Payment error:', error);
                showAlert(error.message || 'Payment failed. Please try again.', 'error');
            } finally {
                showLoading(false, payNowBtn);
            }
        }

        async function processOrder(paymentIntent, shippingAddress) {
            try {
                // Group items by seller
                const ordersBySeller = {};
                cart.forEach(item => {
                    const sellerId = item.sellerId || 'platform';
                    if (!ordersBySeller[sellerId]) {
                        ordersBySeller[sellerId] = [];
                    }
                    ordersBySeller[sellerId].push(item);
                });
                
                // Create separate orders for each seller
                const orderPromises = Object.keys(ordersBySeller).map(async (sellerId) => {
                    const items = ordersBySeller[sellerId];
                    const subtotal = items.reduce((sum, item) => sum + (parseFloat(item.price) * item.quantity), 0);
                    
                    const orderData = {
                        orderId: generateOrderId(),
                        customerId: currentUser.uid,
                        customerName: userProfile.displayName,
                        customerEmail: currentUser.email,
                        sellerId: sellerId,
                        items: items,
                        subtotal: subtotal,
                        shipping: subtotal >= 75 ? 0 : 9.99,
                        total: subtotal + (subtotal >= 75 ? 0 : 9.99),
                        shippingAddress: shippingAddress,
                        paymentIntentId: paymentIntent.id,
                        status: 'confirmed',
                        trackingNumber: null,
                        estimatedDelivery: calculateEstimatedDelivery(items),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    // Save order to Firestore
                    const orderRef = await db.collection('orders').add(orderData);
                    
                    // Update product stock
                    const stockUpdates = items.map(item => {
                        return db.collection('products').doc(item.id).update({
                            stock: firebase.firestore.FieldValue.increment(-item.quantity)
                        });
                    });
                    
                    await Promise.all(stockUpdates);
                    
                    // Send email notifications
                    await sendOrderNotifications(orderRef.id, orderData);
                    
                    return orderRef.id;
                });
                
                await Promise.all(orderPromises);
                
                // Clear user's cart
                if (currentUser) {
                    await db.collection('carts').doc(currentUser.uid).delete();
                }
                
            } catch (error) {
                console.error('Error processing order:', error);
                throw new Error('Order processing failed');
            }
        }

        function generateOrderId() {
            return 'WV-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5).toUpperCase();
        }

        function calculateEstimatedDelivery(items) {
            // Find the longest shipping time among items
            const shippingTimes = items.map(item => item.shippingTime || '3-5');
            const maxTime = shippingTimes.reduce((max, time) => {
                const days = parseInt(time.split('-')[1] || time.split('-')[0]);
                const maxDays = parseInt(max.split('-')[1] || max.split('-')[0]);
                return days > maxDays ? time : max;
            });
            
            const today = new Date();
            const deliveryDate = new Date(today);
            deliveryDate.setDate(today.getDate() + parseInt(maxTime.split('-')[1] || maxTime.split('-')[0]));
            
            return deliveryDate.toLocaleDateString();
        }

        async function sendOrderNotifications(orderId, orderData) {
            try {
                // Send email to customer
                const sendOrderEmail = functions.httpsCallable('sendOrderEmail');
                await sendOrderEmail({
                    to: orderData.customerEmail,
                    type: 'customer_confirmation',
                    orderData: orderData
                });
                
                // Send email to seller (if not platform)
                if (orderData.sellerId !== 'platform') {
                    const sellerDoc = await db.collection('users').doc(orderData.sellerId).get();
                    if (sellerDoc.exists) {
                        await sendOrderEmail({
                            to: sellerDoc.data().email,
                            type: 'seller_notification',
                            orderData: orderData
                        });
                    }
                }
                
            } catch (error) {
                console.error('Error sending notifications:', error);
                // Don't throw error - order was successful even if emails failed
            }
        }

        // ======================
        // SEARCH & FILTER FUNCTIONS
        // ======================
        function handleSearch(e) {
            e.preventDefault();
            const query = elements.searchInput.value.trim().toLowerCase();
            
            if (!query) {
                renderProducts(products);
                return;
            }
            
            const filteredProducts = products.filter(product => 
                product.title.toLowerCase().includes(query) ||
                product.description.toLowerCase().includes(query) ||
                product.category.toLowerCase().includes(query) ||
                product.sellerName.toLowerCase().includes(query)
            );
            
            renderProducts(filteredProducts);
            showAlert(`Found ${filteredProducts.length} products for "${query}"`, 'info');
        }

        function filterByCategory(categoryId) {
            elements.categoryFilter.value = categoryId;
            applyFilters();
        }

        function applyFilters() {
            let filteredProducts = [...products];
            
            // Category filter
            const categoryFilter = elements.categoryFilter.value;
            if (categoryFilter) {
                filteredProducts = filteredProducts.filter(product => 
                    product.category === categoryFilter
                );
            }
            
            // Price filter
            const priceFilter = elements.priceFilter.value;
            if (priceFilter) {
                const [min, max] = priceFilter.split('-');
                filteredProducts = filteredProducts.filter(product => {
                    const price = parseFloat(product.price);
                    if (max) {
                        return price >= parseFloat(min) && price <= parseFloat(max);
                    } else {
                        return price >= parseFloat(min);
                    }
                });
            }
            
            // Sort filter
            const sortFilter = elements.sortFilter.value;
            switch (sortFilter) {
                case 'price-low':
                    filteredProducts.sort((a, b) => parseFloat(a.price) - parseFloat(b.price));
                    break;
                case 'price-high':
                    filteredProducts.sort((a, b) => parseFloat(b.price) - parseFloat(a.price));
                    break;
                case 'rating':
                    filteredProducts.sort((a, b) => (b.rating || 0) - (a.rating || 0));
                    break;
                case 'newest':
                    filteredProducts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    break;
                default: // featured
                    // Keep original order or sort by some featured algorithm
                    break;
            }
            
            renderProducts(filteredProducts);
        }

        // ======================
        // PROFILE & ORDER FUNCTIONS
        // ======================
        function showProfileModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.id = 'profileModal';
            
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <button class="modal-close" onclick="this.closest('.modal').remove()">
                        <i class="fas fa-times"></i>
                    </button>
                    
                    <h2 class="modal-title">My Profile</h2>
                    
                    <form id="profileForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">First Name</label>
                                <input type="text" class="form-input" name="firstName" 
                                       value="${userProfile?.firstName || ''}" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Last Name</label>
                                <input type="text" class="form-input" name="lastName" 
                                       value="${userProfile?.lastName || ''}" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" value="${currentUser?.email || ''}" disabled>
                        </div>
                        
                        <h4 style="margin: 24px 0 16px 0;">Shipping Address</h4>
                        
                        <div class="form-group">
                            <label class="form-label">Street Address</label>
                            <input type="text" class="form-input" name="street" 
                                   value="${userProfile?.address?.street || ''}">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">City</label>
                                <input type="text" class="form-input" name="city" 
                                       value="${userProfile?.address?.city || ''}">
                            </div>
                            <div class="form-group">
                                <label class="form-label">State</label>
                                <input type="text" class="form-input" name="state" 
                                       value="${userProfile?.address?.state || ''}">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">ZIP Code</label>
                                <input type="text" class="form-input" name="zipCode" 
                                       value="${userProfile?.address?.zipCode || ''}">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Country</label>
                                <select class="form-select" name="country">
                                    <option value="US" ${userProfile?.address?.country === 'US' ? 'selected' : ''}>United States</option>
                                    <option value="CA" ${userProfile?.address?.country === 'CA' ? 'selected' : ''}>Canada</option>
                                    <option value="GB" ${userProfile?.address?.country === 'GB' ? 'selected' : ''}>United Kingdom</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 16px; margin-top: 32px;">
                            <button type="button" class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                Save Changes
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Setup form handler
            modal.querySelector('#profileForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                await updateProfile(e.target, modal);
            });
        }

        async function updateProfile(form, modal) {
            try {
                showLoading(true, form.querySelector('button[type="submit"]'));
                
                const formData = new FormData(form);
                const updatedProfile = {
                    firstName: formData.get('firstName'),
                    lastName: formData.get('lastName'),
                    displayName: `${formData.get('firstName')} ${formData.get('lastName')}`,
                    address: {
                        street: formData.get('street'),
                        city: formData.get('city'),
                        state: formData.get('state'),
                        zipCode: formData.get('zipCode'),
                        country: formData.get('country')
                    },
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('users').doc(currentUser.uid).update(updatedProfile);
                
                // Update local profile
                userProfile = { ...userProfile, ...updatedProfile };
                updateAuthUI();
                
                showAlert('Profile updated successfully!', 'success');
                modal.remove();
                
            } catch (error) {
                console.error('Error updating profile:', error);
                showAlert('Failed to update profile', 'error');
            } finally {
                showLoading(false, form.querySelector('button[type="submit"]'));
            }
        }

        async function showOrderHistory() {
            try {
                const ordersSnapshot = await db.collection('orders')
                    .where('customerId', '==', currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const orders = ordersSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.id = 'orderHistoryModal';
                
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 900px;">
                        <button class="modal-close" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i>
                        </button>
                        
                        <h2 class="modal-title">Order History</h2>
                        
                        <div style="max-height: 600px; overflow-y: auto;">
                            ${orders.length === 0 ? 
                                '<p style="text-align: center; color: var(--text-secondary); padding: 60px;">No orders found</p>' :
                                orders.map(order => `
                                    <div style="border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 16px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                            <div>
                                                <h4 style="margin-bottom: 4px;">Order ${order.orderId}</h4>
                                                <div style="color: var(--text-secondary); font-size: 0.9rem;">
                                                    ${new Date(order.createdAt?.toDate()).toLocaleDateString()}
                                                </div>
                                            </div>
                                            <div style="text-align: right;">
                                                <div style="font-size: 1.25rem; font-weight: 700;">${order.total?.toFixed(2)}</div>
                                                <div style="color: var(--${getStatusColor(order.status)}); font-weight: 500; text-transform: capitalize;">
                                                    ${order.status}
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div style="border-top: 1px solid var(--border-light); padding-top: 16px;">
                                            ${order.items?.map(item => `
                                                <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                                                    <img src="${item.image}" alt="${item.title}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px;">
                                                    <div>
                                                        <div style="font-weight: 600; margin-bottom: 4px;">${item.title}</div>
                                                        <div style="color: var(--text-secondary); font-size: 0.9rem;">
                                                            Qty: ${item.quantity} • ${item.price} each
                                                        </div>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                        
                                        ${order.trackingNumber ? `
                                            <div style="margin-top: 16px; padding: 12px; background: var(--background-light); border-radius: 8px;">
                                                <strong>Tracking Number:</strong> ${order.trackingNumber}<br>
                                                <strong>Estimated Delivery:</strong> ${order.estimatedDelivery}
                                            </div>
                                        ` : ''}
                                    </div>
                                `).join('')
                            }
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
            } catch (error) {
                console.error('Error loading order history:', error);
                showAlert('Failed to load order history', 'error');
            }
        }

        function getStatusColor(status) {
            switch (status?.toLowerCase()) {
                case 'confirmed': return 'primary';
                case 'processing': return 'accent';
                case 'shipped': return 'success';
                case 'delivered': return 'success';
                case 'cancelled': return 'error';
                default: return 'text-secondary';
            }
        }

        // ======================
        // EMAIL FUNCTIONS
        // ======================
        async function sendWelcomeEmail(user, firstName) {
            try {
                const sendEmail = functions.httpsCallable('sendEmail');
                await sendEmail({
                    to: user.email,
                    subject: 'Welcome to WEB VTEC!',
                    template: 'welcome',
                    data: {
                        firstName: firstName,
                        loginUrl: window.location.origin
                    }
                });
            } catch (error) {
                console.error('Error sending welcome email:', error);
                // Don't throw error - account creation was successful
            }
        }

        // ======================
        // UTILITY FUNCTIONS
        // ======================
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        function handleModalOutsideClick(e) {
            if (e.target.classList.contains('modal') && e.target.classList.contains('active')) {
                e.target.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        function showAlert(message, type = 'info') {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} show`;
            
            const icon = type === 'success' ? 'check-circle' : 
                        type === 'error' ? 'exclamation-triangle' : 
                        type === 'info' ? 'info-circle' : 'bell';
            
            alert.innerHTML = `
                <i class="fas fa-${icon}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.classList.remove('show');
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.parentNode.removeChild(alert);
                    }
                }, 300);
            }, 4000);
        }

        function showLoading(show, button = null) {
            if (button) {
                if (show) {
                    button.disabled = true;
                    button.innerHTML = button.innerHTML.replace(/<i[^>]*><\/i>/, '<div class="loading"></div>');
                } else {
                    button.disabled = false;
                    // Restore original button content would need to be stored
                }
            }
            
            if (elements.loadingProducts) {
                elements.loadingProducts.style.display = show ? 'block' : 'none';
            }
        }

        function getFirebaseErrorMessage(error) {
            switch (error.code) {
                case 'auth/email-already-in-use':
                    return 'An account with this email already exists.';
                case 'auth/weak-password':
                    return 'Password should be at least 6 characters.';
                case 'auth/invalid-email':
                    return 'Please enter a valid email address.';
                case 'auth/user-not-found':
                    return 'No account found with this email.';
                case 'auth/wrong-password':
                    return 'Incorrect password.';
                case 'auth/too-many-requests':
                    return 'Too many failed attempts. Please try again later.';
                default:
                    return error.message || 'An error occurred. Please try again.';
            }
        }

        // ======================
        // INITIALIZATION COMPLETION
        // ======================
        
        // Check for subscription result on page load
        window.addEventListener('load', handleSubscriptionResult);
        
        // Global functions that need to be accessible from HTML
        window.addToCart = addToCart;
        window.updateCartQuantity = updateCartQuantity;
        window.removeFromCart = removeFromCart;
        window.showProductForm = showProductForm;
        window.editProduct = editProduct;
        window.toggleProductStatus = toggleProductStatus;
        
        // Additional seller functions
        async function editProduct(productId) {
            // Implementation for editing existing products
            showAlert('Edit product feature coming soon!', 'info');
        }
        
        window.editProduct = editProduct;
        
        console.log('WEB VTEC initialized successfully!');


        // Fix missing functions
function showModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
}

function hideModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
    }
}

// Fix category card clicks
document.addEventListener('click', function(e) {
    if (e.target.closest('.category-card')) {
        e.preventDefault();
        const categoryCard = e.target.closest('.category-card');
        const categoryId = categoryCard.dataset.category;
        if (categoryId) {
            filterByCategory(categoryId);
        }
    }
});

// Fix become seller button
function handleBecomeSellerClick() {
    if (!currentUser) {
        showModal('authModal');
        return;
    }
    
    if (userProfile?.isSeller && sellerSubscription?.status === 'active') {
        toggleSellerDashboard();
    } else {
        showModal('subscriptionModal');
    }
}

// Fix missing modal close handlers
document.addEventListener('DOMContentLoaded', function() {
    // Close modals when clicking close buttons
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('modal-close') || e.target.closest('.modal-close')) {
            const modal = e.target.closest('.modal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }
        
        // Close cart when clicking close button
        if (e.target.id === 'cartCloseBtn' || e.target.closest('#cartCloseBtn')) {
            toggleCart();
        }
        
        // Close subscription modal
        if (e.target.id === 'subscriptionClose' || e.target.closest('#subscriptionClose')) {
            hideModal('subscriptionModal');
        }
    });
});



        // Setup footer link functionality
function setupFooterLinks() {
    // Footer links event delegation
    document.querySelector('.footer').addEventListener('click', (e) => {
        if (e.target.tagName === 'A' && e.target.textContent.trim()) {
            e.preventDefault();
            const linkText = e.target.textContent.trim();
            
            switch(linkText) {
                case 'Help Center':
                case 'Contact Support':
                    showHelpModal();
                    break;
                case 'Returns & Refunds':
                    showReturnsModal();
                    break;
                case 'Shipping Information':
                    showShippingModal();
                    break;
                case 'Track Your Order':
                    if (currentUser) {
                        showOrderHistory();
                    } else {
                        showAlert('Please sign in to track orders', 'info');
                        showAuthModal();
                    }
                    break;
                case 'Start Selling':
                case 'Seller Dashboard':
                    handleBecomeSellerClick();
                    break;
                case 'About Us':
                    showAboutModal();
                    break;
                default:
                    showAlert(`${linkText} page coming soon!`, 'info');
            }
        }
    });
}

// Setup category card clicks
function setupCategoryCards() {
    document.addEventListener('click', (e) => {
        const categoryCard = e.target.closest('.category-card');
        if (categoryCard) {
            e.preventDefault();
            const categoryId = categoryCard.dataset.category;
            if (categoryId) {
                // Update nav active state
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                document.querySelector(`[data-category="${categoryId}"]`).classList.add('active');
                filterByCategory(categoryId);
            }
        }
    });
}

// Modal functions for footer links
function showHelpModal() {
    const modal = createModal('Help Center', `
        <div style="max-height: 400px; overflow-y: auto;">
            <h4>Frequently Asked Questions</h4>
            <div style="margin: 16px 0;">
                <strong>Q: How do I place an order?</strong><br>
                <p>Browse products, add items to cart, and click checkout to complete your purchase.</p>
            </div>
            <div style="margin: 16px 0;">
                <strong>Q: How do I become a seller?</strong><br>
                <p>Click "Sell" in the header and subscribe to our seller plan for $25/month.</p>
            </div>
            <div style="margin: 16px 0;">
                <strong>Q: Who handles shipping?</strong><br>
                <p>Individual sellers handle all shipping and fulfillment directly.</p>
            </div>
            <div style="margin: 16px 0;">
                <strong>Q: How do I contact support?</strong><br>
                <p>Email us at support@webvtec.com or use the contact form below.</p>
            </div>
        </div>
        <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border);">
            <h4>Contact Us</h4>
            <form id="contactForm" style="margin-top: 16px;">
                <div class="form-group">
                    <input type="email" class="form-input" placeholder="Your email" required>
                </div>
                <div class="form-group">
                    <textarea class="form-textarea" placeholder="Your message" rows="4" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Send Message</button>
            </form>
        </div>
    `);
    
    modal.querySelector('#contactForm').addEventListener('submit', (e) => {
        e.preventDefault();
        showAlert('Message sent! We\'ll get back to you within 24 hours.', 'success');
        modal.remove();
    });
}

function showReturnsModal() {
    createModal('Returns & Refunds', `
        <div style="max-height: 400px; overflow-y: auto;">
            <p><strong>Return Policy:</strong> Each seller sets their own return policy. Check the product page for specific return terms.</p>
            <br>
            <p><strong>How to Return:</strong></p>
            <ol>
                <li>Contact the seller directly through your order page</li>
                <li>Follow the seller's return instructions</li>
                <li>Ship the item back as directed</li>
                <li>Seller will process refund upon receipt</li>
            </ol>
            <br>
            <p><strong>Refund Timeline:</strong> Typically 3-5 business days after seller receives returned item.</p>
            <br>
            <p><strong>Need Help?</strong> Contact our support team if you have issues with a return.</p>
        </div>
    `);
}

function showShippingModal() {
    createModal('Shipping Information', `
        <div style="max-height: 400px; overflow-y: auto;">
            <p><strong>Shipping Policy:</strong> All shipping is handled directly by individual sellers.</p>
            <br>
            <p><strong>Shipping Times:</strong> Each product shows estimated shipping time from that specific seller.</p>
            <br>
            <p><strong>Shipping Costs:</strong> Determined by each seller. Many offer free shipping promotions.</p>
            <br>
            <p><strong>Tracking:</strong> You'll receive tracking information from the seller once your order ships.</p>
            <br>
            <p><strong>Multiple Items:</strong> If you order from multiple sellers, items may arrive separately.</p>
        </div>
    `);
}

function showAboutModal() {
    createModal('About WEB VTEC', `
        <div style="max-height: 400px; overflow-y: auto;">
            <p>WEB VTEC is a premier online marketplace connecting buyers with independent sellers worldwide.</p>
            <br>
            <p><strong>Our Mission:</strong> To provide a platform where anyone can start their own business and reach customers globally.</p>
            <br>
            <p><strong>For Buyers:</strong> Discover unique products from independent sellers with competitive prices and personalized service.</p>
            <br>
            <p><strong>For Sellers:</strong> Start your online business with our easy-to-use platform and reach millions of potential customers.</p>
            <br>
            <p><strong>Founded:</strong> 2024</p>
            <p><strong>Headquarters:</strong> United States</p>
        </div>
    `);
}

// Helper function to create modals
function createModal(title, content) {
    const modal = document.createElement('div');
    modal.className = 'modal active';
    modal.innerHTML = `
        <div class="modal-content">
            <button class="modal-close">
                <i class="fas fa-times"></i>
            </button>
            <h2 class="modal-title">${title}</h2>
            <div>${content}</div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    modal.querySelector('.modal-close').addEventListener('click', () => {
        modal.remove();
        document.body.style.overflow = '';
    });
    
    document.body.style.overflow = 'hidden';
    return modal;
}
    </script>
</body>
</html>
